<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Recibo LayAway</title>
  <style>
    /* (Opcional) estilos para la vista rápida en navegador */
    body { font-family: monospace; margin:0; padding:0; }
    .receipt { width:280px; margin:auto; padding:8px; }
    .header { text-align:center; font-size:1.2em; font-weight:bold; }
    .line { border-top:1px dashed #000; margin:4px 0; }
    .field { display:flex; justify-content:space-between; }
    .footer { text-align:center; margin-top:6px; font-size:0.9em; }
  </style>
  <script>
    // 1) Leer el JSON pasado por URL
    const params = new URLSearchParams(location.search);
    let data = {};
    try {
      data = JSON.parse(decodeURIComponent(params.get("data")));
    } catch(e) {
      console.error("JSON inválido", e);
    }

    // 2) Extraer los campos (asegúrate que coincidan con AppSheet)
    const {
      LayawayKey = "",
      Name       = "",
      Phone      = "",
      StartDate  = "",
      TotalAmt   = "",
      Notas      = ""
    } = data;

    // 3) Construir el bloque de texto plano para RawBT
    const block =
`╔════════════════════╗
║      LAYAWAY       ║
╚════════════════════╝
Key:       ${LayawayKey}
Cliente:   ${Name}
Teléfono:  ${Phone}
Fecha:     ${StartDate}
Monto:     S/${TotalAmt}
Notas:     ${Notas}

`;

    // 4) Crear el URI sin slash extra después de "print"
    const uri = "rawbt://print?contentType=raw&content=" + encodeURIComponent(block);

    // 5) Insertar meta-refresh en el <head> para redirigir de inmediato
    document.write(`<meta http-equiv="refresh" content="0;url=${uri}">`);
  </script>
</head>
<body>
  <!-- Nunca verás este contenido, salta directo a RawBT -->
  <p style="text-align:center; margin-top:20px;">Preparando impresión…</p>
</body>
</html>
