<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Recibo LayAway</title>
  <style>
    body { font-family: monospace; margin:0; padding:8px; }
    .receipt { white-space: pre-wrap; }
    .note { color: #888; font-size: 0.9em; margin-top:16px; }
  </style>
  <script>
    // 1) Leer JSON
    const params = new URLSearchParams(location.search);
    let data = {};
    try {
      data = JSON.parse(decodeURIComponent(params.get("data")));
    } catch(e) {
      data = { error: "JSON inválido o faltante" };
    }

    // 2) Construir bloque
    const {
      LayawayKey = "",
      Name       = "",
      Phone      = "",
      StartDate  = "",
      TotalAmt   = "",
      Notas      = ""
    } = data;
    const block =
`╔════════════════════╗
║      LAYAWAY       ║
╚════════════════════╝
Key:       ${LayawayKey}
Cliente:   ${Name}
Teléfono:  ${Phone}
Fecha:     ${StartDate}
Monto:     S/${TotalAmt}
Notas:     ${Notas}

`;

    // 3) Mostrarlo en pantalla
    document.addEventListener('DOMContentLoaded', () => {
      document.body.innerHTML =
        `<div class="receipt">${block}</div>` +
        `<div class="note">Imprimiendo en 1 s…</div>`;
    });

    // 4) Lanzo RawBT tras 1 s
    const uri = "rawbt://print?contentType=raw&content=" + encodeURIComponent(block);
    setTimeout(() => {
      window.location.href = uri;
    }, 1000);
  </script>
</head>
<body>
  <!-- aparecerá el recibo generado aquí -->
</body>
</html>
