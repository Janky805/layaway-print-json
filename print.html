<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Recibo LayAway</title>
  <style>
    body {
      font-family: monospace;
      padding: 0;
      margin: 0;
      background: #fff;
      color: #000;
    }
    .receipt {
      width: 280px;
      margin: auto;
      padding: 8px;
    }
    .header {
      text-align: center;
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 4px;
    }
    .line {
      border-top: 1px dashed #000;
      margin: 4px 0;
    }
    .field {
      display: flex;
      justify-content: space-between;
      margin: 2px 0;
    }
    .footer {
      text-align: center;
      margin-top: 6px;
      font-size: 0.9em;
    }
  </style>
  <script>
    // 1) Leer parámetros JSON de la URL
    const params = new URLSearchParams(location.search);
    let data = {};
    try {
      data = JSON.parse(decodeURIComponent(params.get("data")));
    } catch(e) {}
    const { LayawayKey, Name, Phone, StartDate, TotalAmt, Notas } = data;

    // 2) Construir el bloque de texto plano para RawBT
    const block =
`╔════════════════════╗
║      LAYAWAY       ║
╚════════════════════╝
Key:       ${LayawayKey}
Cliente:   ${Name}
Teléfono:  ${Phone}
Fecha:     ${StartDate}
Monto:     S/${TotalAmt}
Notas:     ${Notas}
╔════════════════════╗
║   ¡Gracias! Vuelva ║
║    Pronto         ║
╚════════════════════╝
`;

    // 3) Mostrar HTML bonito
    document.addEventListener('DOMContentLoaded', () => {
      document.body.innerHTML = `
        <div class="receipt">
          <div class="header">LAYAWAY</div>
          <div class="line"></div>
          <div class="field"><span>Key</span><span>${LayawayKey}</span></div>
          <div class="field"><span>Cliente</span><span>${Name}</span></div>
          <div class="field"><span>Teléfono</span><span>${Phone}</span></div>
          <div class="field"><span>Fecha</span><span>${StartDate}</span></div>
          <div class="field"><span>Monto</span><span>S/${TotalAmt}</span></div>
          <div class="field"><span>Notas</span><span>${Notas}</span></div>
          <div class="line"></div>
          <div class="footer">¡Gracias por tu preferencia!</div>
        </div>
      `;
    });

    window.onload = () => {
    // usa _sin_ slash después de "print"
    const uri =
      "rawbt://print?contentType=raw&content=" +
      encodeURIComponent(block);
    window.location.href = uri;
  };
  <p style="text-align:center; margin-top:20px;">Preparando impresión…</p>
</body>
</html>

