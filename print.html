<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Recibo LayAway</title>
  <script>
    // 1) Leer el JSON que viene en "data"
    const params = new URLSearchParams(location.search);
    let data = {};
    try {
      data = JSON.parse(decodeURIComponent(params.get("data")));
    } catch(e) {
      console.error("JSON inválido", e);
    }

    // 2) Extraer campos con valores por defecto
    const {
      LayawayKey = "",
      Name       = "",
      Phone      = "",
      StartDate  = "",
      TotalAmt   = "",
      Notas      = ""
    } = data;

    // 3) Construir el bloque plano para RawBT
    const block =
`╔════════════════════╗
║      LAYAWAY       ║
╚════════════════════╝
Key:       ${LayawayKey}
Cliente:   ${Name}
Teléfono:  ${Phone}
Fecha:     ${StartDate}
Monto:     S/${TotalAmt}
Notas:     ${Notas}

`;

    // 4) URI sin slash extra tras "print"
    const uri = "rawbt://print?contentType=raw&content=" + encodeURIComponent(block);

    // 5) Redirigir instantáneamente sin mostrar nada más
    window.location.replace(uri);
  </script>
  <style>
    /* Opcional: si tarda, veremos este mensaje */
    body {
      font-family: monospace;
      text-align: center;
      padding-top: 50px;
    }
  </style>
</head>
<body>
  <p>Preparando impresión…</p>
  <p>Si no ocurre nada, <a id="link" href="#">haz clic aquí</a>.</p>
  <script>
    // Fallback manual
    document.getElementById('link').href = uri;
  </script>
</body>
</html>
